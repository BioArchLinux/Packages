# maintainer: Guoyi
pkgname=freebayes
pkgver=1.3.6
pkgrel=1
pkgdesc="About Bayesian haplotype-based genetic polymorphism discovery and genotyping"
arch=('x86_64')
url="https://github.com/freebayes/freebayes"
license=('MIT')

depends=('tabixpp' 'vcflib' 'vcftools' 'samtools' 'parallel' 'bc')
makedepends=('ninja' 'meson' 'git' 'cmake' 'make')
optdepends=()

source=(git+https://github.com/freebayes/freebayes.git#tag=v${pkgver})
noextract=()
sha256sums=('SKIP')
prepare() {
  cd "$pkgname"
  git submodule update --init --recursive
  # find vcflib
  sed -i "s|dependency('libvcflib'|cc.find_library('libvcflib'|g" meson.build
  sed -i "s|dependency('libseqlib'|cc.find_library('libseqlib'|g" meson.build
  # sed -i "167c include_directories : [ seqlib_inc]," meson.build

  # fix limits
  sed -i "/#include <limits>/d" intervaltree/IntervalTree.h
  sed -i "8i #include <limits>" intervaltree/IntervalTree.h
}
build() {
  cd "$pkgname"
  test -d build || mkdir build
  meson --prefix=/usr --buildtype=release --includedir=/usr/include/vcflib	  build -Dprefer_system_deps=true
  cd build
  ninja -v
}

package() {
  cd "$pkgname-$pkgver"
  install -Dm 755 build/freebayes $pkgdir/usr/bin/freebayes
}
