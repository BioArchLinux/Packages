_base=Qiber3D
pkgname=python-qiber3d
pkgver=0.7.0.r8.gb126aea
pkgrel=2
pkgdesc="Automated quantification of fibrous networks \
	 https://doi.org/10.1093/gigascience/giab091"
arch=(any)
url="https://github.com/theia-dev/Qiber3D"
license=(MIT)
depends=(python-pillow python-numpy python-scikit-image python-tqdm python-scipy
	vtk python-openpyxl python-blosc python-matplotlib python-networkx python-tifffile
	python-pims python-vedo python-nd2reader
	ospray openvr anari-sdk opencascade liblas cgns paraview-catalyst viskores adios2 gl2ps
	)
makedepends=(git python-setuptools)
source=(git+$url.git#branch=dev
	fix_py3.13.patch::https://github.com/theia-dev/Qiber3D/pull/4.patch)
sha512sums=('SKIP'
            '01d63ece5153044ef22ac9ed6cb648e920e0acefe98f7d53a39688cc458b49c00c2ba74bbce0357010608d41884114440de80b5fbcb7b40e6ab0d37b8ac89f97')

pkgver() {
  git -C ${_base} describe --long --tags | sed 's/^v//;s/\([^-]*-g\)/r\1/;s/-/./g'
}

prepare(){
  cd ${_base}
  patch -p1 < ../fix_py3.13.patch
}

build() {
  cd ${_base}
  python3 setup.py build
}


package() {
  cd ${_base}
  python3 setup.py install --root=$pkgdir --optimize=1 --skip-build
}

