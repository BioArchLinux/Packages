# Maintainer: Guoyi ("malcology") <guoyizhang@malacology.net>
# Contributor: Guoyi ("malcology") <guoyizhang@malacology.net>

pkgname=raxml-ng-mpi
pkgver=1.1.0
pkgrel=18
pkgdesc="A phylogenetic tree inference tool which uses maximum-likelihood (ML) optimality criterion. https://doi.org/10.1093/bioinformatics/btz305"
url='https://github.com/amkozlov/raxml-ng'
arch=('x86_64')
license=('AGPL3')
depends=('gcc-libs' 'openmpi' 'cuda')
makedepends=('bison' 'make' 'cmake' 'flex' 'gmp' 'gtest' 'git')
source=("https://github.com/amkozlov/raxml-ng/archive/refs/tags/${pkgver}.zip")
sha256sums=('2d2d4143c50b86e40cfc9ecb328e96b2a68a166001433bf939a0c38048257d34')

prepare() {
  cd "${srcdir}/raxml-ng-${pkgver}/libs"
  git clone git@github.com:amkozlov/terraphast-one.git
  rm -rf terraphast
  mv terraphast-one terraphast
  git clone git@github.com:ddarriba/pll-modules.git
  cd pll-modules/libs/
  rm -rf libpll
  git clone git@github.com:xflouris/libpll-2.git
  mv libpll-2 libpll
  cp libpll/src/pll.h pll.h
}
build(){
  cd "${srcdir}"/raxml-ng-${pkgver}
  mkdir -p build
  cd build
  cmake -DUSE_MPI=ON ..
  make
}
package() {
  cd ${srcdir}/raxml-ng-${pkgver}/bin
  install -Dm755 $pkgname "${pkgdir}/usr/bin/${pkgname}"
}
