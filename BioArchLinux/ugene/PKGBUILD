ugene#Maintainer Matthijs Tadema <M dot J dot Tadema at pm dot me>
#Previous Maintainer Jens Staal <staal1978@gmail.com>

pkgname=ugene
pkgver=41.0
pkgrel=4
pkgdesc="A free cross-platform genome analysis suite. https://doi.org/10.1093/bioinformatics/bts091"
arch=('x86_64')
url="http://ugene.net"
license=('GPL')
depends=('libxtst' 'glu' 'qt5-webkit' 'qt5-websockets' 'qt5-svg' 'qt5-script' 'desktop-file-utils' 'qspec' 'opencl-driver')
makedepends=('opencl-headers')
optdepends=('cufflinks' 'bowtie' 'clustalw' 'phyml' 'blast+' 'clustal-omega' 'vcftools' 'mrbayes' 'bwa' 'bedtools'
	'tcoffee' 'hmmer' 'snpeff' 'samtools' 'mafft' 'trimmomatic' 'stringtie' 'kraken' 'diamond-aligner'
	'python2-cutadapt' 'python' 'java-runtime' 'bowtie2' 'tophat' 'fastqc')
provides=('ugene')
conflicts=('ugene-git')
source=("https://github.com/ugeneunipro/ugene/archive/refs/tags/${pkgver}.tar.gz")
sha256sums=('eab798354f71d8b21e4dff94e76abc48ca0e59e3d5234bf25d269960ef4be0b9')

build() {
  cd "${srcdir}"/ugene-${pkgver}
  CXXFLAGS="$CXXFLAGS -Wno-depreceated"
  OPENCL_INC_PATH=/usr/include/CL
  qmake -r CONFIG+=x64 PREFIX=${pkgdir}/opt/ugene UGENE_OPENCL_DETECTED=1 UGENE_USE_SYSTEM_SQLITE=1 UGENE_USE_BUNDLED_ZLIB=0 .
  make -j 4
}

package() {
  cd "${srcdir}"/ugene-${pkgver}
  make PREFIX=${pkgdir}/opt/ugene install
  mkdir -p ${pkgdir}/usr/bin
  ln -s /opt/ugene/ugene ${pkgdir}/usr/bin/ugene
  mkdir -p ${pkgdir}/usr/share/applications
  ln -s /opt/ugene/ugene.desktop ${pkgdir}/usr/share/applications/ugene.desktop
}

post_install() {
  update-desktop-database -q
}
post_remove() {
  update-desktop-database -q
}

